@page "/gate3/3FBC748A-5C13-42B6-8FC4-53B2A9EB6B21"
@rendermode InteractiveAuto

@inject NavigationManager nav
@inject IJSRuntime js
@inject IConfiguration config

<PageTitle>Gate III - Chapter IV</PageTitle>

<style>
    html, body {
        color: azure;
        font-family: 'CipherFont', CipherFont, Arial, sans-serif;
        background-color: #000
    }
</style>

<title>Gate III - Chapter IV</title>

<div class="container">
    <article>
        <h3 style="color: red"> Gate III - Chapter IV</h3>
        <button class="btn btn-primary" @onclick=@GoHome>Go Back</button>

        <br />
        <br />

        @foreach (var (line, idx) in articleBody.Split('\n').Select((l, i) => (l, i)))
        {
            <div class="narrative-line" style="animation-delay:@($"{idx * 1.5:F1}s")">
                @line
            </div>
            <br />
        }

        <button class="btn btn-primary" @onclick=@GoToChapterTwo>Continue</button>
    </article>
</div>

@code {
    string articleBody = string.Empty;
    string? apiKey;

    HttpClient http = new HttpClient();
    int gateNumber = 3;
    int chapter = 4;

    protected override async Task OnInitializedAsync()
    {
        apiKey = config["ClientUnsecuredApiKey"] ?? string.Empty;
        articleBody = await Common.GetNarrative(nav, http, apiKey, gateNumber, chapter);
    }

    private void GoHome() => nav.NavigateTo("/gate3");

    private void GoToChapterTwo() => nav.NavigateTo("/gate3/9888A581-3587-4137-837C-D0BC1A11C83B");

}